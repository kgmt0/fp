import [fp]

export [test [run-tests]]

to test [name thunk expected]
  let result runresult thunk
  if result != expected [
    error (word "Test failed: " name "\nExpected: " expected "\nGot: " result)
  ]
end

to run-tests
  test  "Adding two numbers from a list together"
        [[] -> fp:apply [[a b] -> a + b] [10 5]]
        15

  test  "Using apply on list of lists"
        [[] -> map [l -> fp:apply "word" l] [[1 2 3] [4 5] [6 7 8 9]]]
        ["123" "45" "6789"]

  test  "Take the first 2 elements in the list [\"a\" \"b\" \"c\"]"
        [[] -> fp:take 2 ["a" "b" "c"]]
        ["a" "b"]

  test  "Take the first 5 elements in the list [0 1 ... 9]"
        [[] -> fp:take 5 (range 10)]
        [0 1 2 3 4]

  test  "Drop all but the last 2 elements in the list [\"a\" \"b\" \"c\"]"
        [[] -> fp:drop 2 ["a" "b" "c"]]
        ["c"]

  test  "Drop the first 5 elements in the list [0 1 ... 9]"
        [[] -> fp:drop 5 (range 10)]
        [5 6 7 8 9]

  test  "Applies the addition operation to the given list starting from the beginning and returns a list consisiting of all the resulting values"
        [[] -> fp:scan [[x y] -> x + y] [1 2 3 4 5]]
        [1 3 6 10 15]

  test  "Applies the given anonymous reporter to the given list starting from the beginning and returns a list consisiting of all the resulting values"
        [[] -> fp:scan [[a b] -> a] [1 2 3 4 5]]
        [1 1 1 1 1]

  test  "Combines the two given reporters. The resulting reporter first adds 5 to x and then divides it by 2."
        [[] -> runresult (fp:compose [x -> x / 2] [x -> x + 5]) 4]
        4

  test  "Combines the two given reporters. The resulting reporter first divides x by 2 and then adds 5."
        [[] -> runresult (fp:pipe [x -> x / 2] [x -> x + 5]) 3]
        7

  test  "Finds the indices of the elements in the given list that are equal to 2."
        [[] -> fp:find-indices [x -> x = 2] [1 2 1 2]]
        [1 3]

  test  "Finds the indices of the elements in the given list that are alpha-numerically less than the symbol \"b\"."
        [[] -> fp:find-indices [x -> x < "b"] ["b" "a" "b" "c" "a"]]
        [1 4]

  test  "Find the first element in the given list that starts with a \"t\""
        [[] -> fp:find [ s -> first s = "t" ] ["hi" "there" "everyone"]]
        "there"

  test  "Find the first element in the given list that is equla to 3. Since there are none, it returns False."
        [[] -> fp:find [x -> x = 3] [1 2 1 2]]
        False

  test  "Flatten nested list"
        [[] -> fp:flatten [[1 2 3] [4 5]]]
        [1 2 3 4 5]

  test  "Flatten deeply nested list"
        [[] -> fp:flatten [[[1 [2] 3]][[4 [5]] [6]]]]
        [1 2 3 4 5 6]

  test  "Create a new list from the given two lists where the ith items are paired together"
        [[] -> fp:zip [1 2 3] [4 5 6]]
        [[1 4] [2 5] [3 6]]

  test  "Create a new list from the given list of lists where the ith items in the sublists are paired together"
        [[] -> fp:unzip [[1 4] [2 5] [3 6]]]
        [[1 2 3] [4 5 6]]

  ;; TODO: Fix this
  ;; test  "Create a new list from the given list of lists where the ith items in the sublists are paired together. In this case the sublists in the given list are of different lengths, so the sublists in the list that is returned are also of different lengths."
  ;;       [[] -> fp:unzip [[1 "a"] [2 "b"] [3 "c"] [4]]]
  ;;       [[1 2 3 4] ["a" "b" "c"]]

  test  "Calculate the first 6 powers of two:"
        [[] -> fp:iterate [[a] -> a * 2] 1 5]
        [1 2 4 8 16 32]

  test  "Calculate the first 6 powers of two, keeping only the final result:"
        [[] -> fp:iterate-last [[a] -> a * 2] 1 5]
        32

  test  "Add more and more exclamation points:"
        [[] -> fp:iterate [[a] -> (word a "!")] "hey" 5]
        ["hey" "hey!" "hey!!" "hey!!!" "hey!!!!" "hey!!!!!"]

  test  "Add more and more exclamation points:"
        [[] -> fp:iterate [[a] -> (word a "!")] "hey" 5]
        ["hey" "hey!" "hey!!" "hey!!!" "hey!!!!" "hey!!!!!"]

  test  "Add more and more exclamation points, keeping only the final result:"
        [[] -> fp:iterate-last [[a] -> (word a "!")] "hey" 5]
        "hey!!!!!"

  test  "Alternate true/false values:"
        [[] -> fp:iterate [[a] -> not a] true 5]
        [true false true false true false]

  test  "Alternate true/false values, keeping only the final result:"
        [[] -> fp:iterate-last [[a] -> not a] true 5]
        false

  print "All tests succeeded"
end
